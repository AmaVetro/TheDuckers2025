import { useParams, useNavigate } from "react-router-dom";
import { useEffect, useState } from "react";
import { getProductById } from "../services/productService";
import { clp } from "../utils/currency";



//(2)

export const ProductDetailView = ({ handler }) => {


    //(2)
    const { id } = useParams(); 
    const [product, setProduct] = useState(null);  
    const [isLoading, setIsLoading] = useState(true); 



    const navigate = useNavigate();



    //(2)
    useEffect(() => {
        const loadProduct = async () => {  
            try {                         
                const prod = await getProductById(id); 
                setProduct(prod); 
            } catch (error) { 
                console.error('Error cargando producto', error); 
            } finally {  
                setIsLoading(false); 
            }
        };
        loadProduct();
    }, [id]); 





    if (isLoading) {
        return (
            <div className="alert alert-info mt-3">
                Cargando producto...
            </div>
        );
    }

    if (!product) {
        return (
            <div className="alert alert-danger mt-3">
                Producto no encontrado.
            </div>
        );
    }

    const onAddProduct = () => {
        handler({ 
            id: product.id,
            name: product.name,
            description: product.description,
            price: product.price,
        });
        alert("Producto agregado exitosamente al carrito.");
    };





    return (
        <div className="container my-4"> 
            <div className="row g-4">

                {/* 2 xxxxx */}
                <div className="col-12 col-md-5">
                    <div className="card">
                        <img 
                            src={product.image}
                            alt={product.name}
                            className="card-img-top"
                            style={{ objectFit: "cover", width: "100%" }}
                        />
                    </div>
                </div>


                {/* 2 */}
                <div className="col-12 col-md-7">
                    <div className="card h-100">
                        <div className="card-body">
                            <h3 className="card-title mb-2">{product.name}</h3>
                            <p className="card-text mb-3">{product.description}</p>

                            <p className="h4 mb-3">{clp(product.price)}</p>

                            <>
                                <h5 className="mt-3">Especificaciones técnicas</h5>
                                <ul>
                                    {product.specs.map((spec, idx) => (
                                        <li key={idx}>{spec}</li>
                                    ))}
                                </ul>
                            </>


                            {/* 2 */}
                            <div className="mt-4 d-flex gap-2">
                                <button className="btn btn-primary" onClick={onAddProduct}>
                                    Añadir al carrito
                                </button>
                                <button
                                    className="btn btn-outline-secondary"
                                    onClick={() => navigate(-1)}    //(2)*****
                                >   
                                    Volver atrás
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

// (3) HomeView